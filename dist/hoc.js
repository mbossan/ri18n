'use strict';Object.defineProperty(exports,'__esModule',{value:true});var _extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key]}}}return target};var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if('value'in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _hoistNonReactStatics=require('hoist-non-react-statics');var _hoistNonReactStatics2=_interopRequireDefault(_hoistNonReactStatics);var _redux=require('./redux');var _react=require('react');var _invariant=require('invariant');var _invariant2=_interopRequireDefault(_invariant);var _propTypes=require('prop-types');var _propTypes2=_interopRequireDefault(_propTypes);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError('Cannot call a class as a function')}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError('this hasn\'t been initialised - super() hasn\'t been called')}return call&&(typeof call==='object'||typeof call==='function')?call:self}function _inherits(subClass,superClass){if(typeof superClass!=='function'&&superClass!==null){throw new TypeError('Super expression must either be null or a function, not '+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}exports.default=function(){return function(WrappedComponent){(0,_invariant2.default)(typeof WrappedComponent==='function','You must pass a component to the function returned by localize.\n      Instead received '+JSON.stringify(WrappedComponent));var WithI18n=function(_PureComponent){_inherits(WithI18n,_PureComponent);function WithI18n(props,context){_classCallCheck(this,WithI18n);var _this=_possibleConstructorReturn(this,(WithI18n.__proto__||Object.getPrototypeOf(WithI18n)).call(this,props,context));_initialiseProps.call(_this);var store=_this.context.store.getState();_this.state={lang:_redux.selectors.lang(store),t:function t(key,replacements,number){return _redux.selectors.t(store,{key:key,replacements:replacements,number:number})}};return _this}_createClass(WithI18n,[{key:'componentDidMount',value:function componentDidMount(){this.mounted=true;this.unsubscribe=this.context.store.subscribe(this.listener)}},{key:'componentWillUnmount',value:function componentWillUnmount(){this.mounted=false;if(this.unsubscribe)this.unsubscribe()}},{key:'render',value:function render(){return(0,_react.createElement)(WrappedComponent,_extends({},this.props,this.state))}}]);return WithI18n}(_react.PureComponent);WithI18n.contextTypes={store:_propTypes2.default.object.isRequired};var _initialiseProps=function _initialiseProps(){var _this2=this;this.listener=function(){if(!_this2.mounted)return;var store=_this2.context.store.getState();if(_this2.state.lang!==_redux.selectors.lang(store))_this2.setState({lang:_redux.selectors.lang(store),t:function t(key,replacements,number){return _redux.selectors.t(store,{key:key,replacements:replacements,number:number})}})}};return(0,_hoistNonReactStatics2.default)(WithI18n,WrappedComponent)}};